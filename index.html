<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WebAppPassword window.open() Test</title>
    <style>
        body { font-family: 'Calibri', 'Arial', 'sans-serif'; }
        textarea { width: 100%; height: 50px; }
    </style>
</head>
<body>
<header>
    <h1>WebAppPassword window.open() Test</h1>
</header>
<main>
    <label>
        Server url:
        <input type="text" size="32" id="server-url" name="server-url" value="http://localhost:8081/index.php" />
    </label>

    <button onclick="login()">Login</button>

    <h2>Output</h2>

    <textarea id="output"></textarea>
</main>
<footer></footer>
</body>
<script>
    let wnd;
    const textArea = document.querySelector("#output");
    const serverUrl = document.querySelector("#server-url").value;

    function login() {
        textArea.value = "";
        wnd = window.open(serverUrl + "/apps/webapppassword/?target-origin=" + encodeURIComponent(window.location.href), "Nextcloud Login",
            "width=400,height=400,menubar=no,scrollbars=no,status=no,titlebar=no,toolbar=no");
    }

    window.addEventListener('message', (event) => {
        const data = event.data;
        console.log("data", data);

        if (data.type === "webapppassword") {
            wnd.close();

            // textArea.value = "Login name:\n" + data.loginName + "\n\nApp password:\n" + data.token;
            textArea.value = JSON.stringify(data);
        }
    });
</script>
</html>
